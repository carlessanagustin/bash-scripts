#!/bin/bash -ex


# see: http://www.androidtablets.net/threads/rotating-screen-touchpad-on-linux.33309/


function rotate_screen_icon() {
    local self=$(readlink -f "${BASH_SOURCE[0]}")
    local dir=$(dirname $self)

    if [ ! -f ~/.local/share/applications/rotate-screen.desktop ] ;then
        cat <<EOF > ~/.local/share/applications/rotate-screen.desktop
[Desktop Entry]
Encoding=UTF-8
Version=1.0
Name=Rotate
Comment=Rotate Screen
Type=Application
Exec=${self}
Icon=/usr/share/icons/gnome/48x48/actions/view-refresh.png
Terminal=false
Categories=Settings
StartupNotify=true
EOF
    fi
}


function rotate_screen_action() {
    local device=$(xrandr --listproviders | head -3 | tail -1 | sed -E 's/[ \t]+/ /g' | cut -d' ' -f3)
    rotation=${1:-normal}
    xrandr --output ${device} --auto --rotate ${rotation}
}


rotate_screen_icon; rotate_screen_action $*
