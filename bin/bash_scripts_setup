#!/bin/bash -e

function __bash_setup_postactivate(){
    dir=$(dirname $(readlink -f "${BASH_SOURCE[0]}"))
cat <<EOF
#!/bin/bash -e
# created by http://github.com/frgomes/bash-scripts

#################################################################
###                                                           ###
###              DO NOT EDIT THIS SCRIPT BY HAND              ###
###                                                           ###
### ANY CHANGES MADE BY HAND ON THIS FILE WILL BE OVERWRITTEN ###
###                                                           ###
#################################################################


# echo "[ Make sure directory structure is created ]"
for folder in "\${VIRTUAL_ENV:-\${HOME}/.local/share/bash-scripts}"/{bin,postactivate/head.d,postactivate/postactivate.d,postactivate/tail.d} ;do
    [[ ! -d "\${folder}" ]] && mkdir -p "\${folder}"
done

# echo "[ Run initialization scripts ]"
for script in "\${VIRTUAL_ENV:-\${HOME}/.local/share/bash-scripts}"/postactivate/head.d/*.sh \\
              "\${VIRTUAL_ENV:-\${HOME}/.local/share/bash-scripts}"/postactivate/postactivate.d/*.sh \\
              "\${VIRTUAL_ENV:-\${HOME}/.local/share/bash-scripts}"/postactivate/tail.d/*.sh ;do
    [[ -x "\${script}" ]] && echo "sourcing \${script}" && source "\${script}"
done
EOF
}

function __bash_setup_virtualenv_dir {
    if [ -z "${VIRTUAL_ENV}" ] ;then
      if [ -z "$1" ] ;then
        echo "${HOME}/.local/share/bash-scripts"
      else
        echo "${VIRTUALENVWRAPPER_HOOK_DIR}/${1}"
      fi
    else
      if [ -z "$1" ] ;then
        echo "${VIRTUAL_ENV}"
      else
        echo "${VIRTUALENVWRAPPER_HOOK_DIR}/${1}"
      fi
    fi
}


function __bash_setup_postactivate_overwrite {
    local virtualenv_dir=$(__bash_setup_virtualenv_dir "$1")
    [[ -d "${virtualenv_dir}" ]] || mkdir -p "${virtualenv_dir}"
    __bash_setup_postactivate > "${virtualenv_dir}"/bin/postactivate
    chmod u+x "${virtualenv_dir}"/bin/postactivate
}


__bash_setup_postactivate_overwrite "$1"
